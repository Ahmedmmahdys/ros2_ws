# Crane Panel Builder Workspace

This workspace now focuses on the RCAN (Robotic Construction Automation
Network) flow for sequencing wall and column panel pick-and-place motions for a
crane using only the IFC GUID, the panel's pick position, and the placement
target position. All orchestration runs through the RCAN servicesâ€”there is no
fallback pipeline to maintain or configure.

## Packages

- `rcan_core`: owns the message broker, Neo4j database integration, task
  allocation, node generation, robot execution simulation, and state management
  services that collectively drive the installation workflow. It now also
  exposes a command line interface for sequencing installations directly
  through RCAN.
- `rcan_nodes`: hosts the ROS 2 launch and templated node artifacts generated by
  the RCAN services during execution.

## Usage

### Build the workspace (all packages)

1. Build the workspace and source the overlay:
   ```bash
   cd /path/to/ros2_ws
   colcon build --symlink-install
   source install/setup.bash
   ```

### Run the RCAN demo orchestrator

The RCAN orchestrator (`rcan_core`) wires together the in-process message broker,
Neo4j-backed panel queries, template-based ROS node generation, and a simulated
robot executor. The snippet below shows a full shell session that builds the
workspace, configures Neo4j credentials, and launches the demo end to end:

```bash
cd /path/to/ros2_ws
colcon build --symlink-install
source install/setup.bash

# Point the orchestrator at your Neo4j instance
export RCAN_NEO4J_URI=bolt://localhost:7687
export RCAN_NEO4J_USER=neo4j
export RCAN_NEO4J_PASSWORD=secret

# (Optional) choose the exact panel GUID to install
export RCAN_DEMO_IFCGUID=X1

# Run the end-to-end workflow
python -m rcan_core.main_rcan
```

After the command finishes you will find the generated node under
`src/rcan_nodes/rcan_nodes/generated/` (for example,
`install_panel_X1.py`) and the panel state recorded back in Neo4j via the state
manager service.

For additional context, the ordered list below explains the prerequisites in
more detail:

1. Ensure your Neo4j instance contains panels with the `Panel` label and the
   `ifcguid`, `HookPoint`, and `TargetPosition` properties required by the
   database API (see `src/rcan_core/rcan_core/db_api.py` for details). If you do
   not have a live database, the test fixture in
   `src/rcan_core/tests/test_main_rcan.py` shows how to mock the driver.
2. Export the Neo4j connection settings expected by `rcan_core.config` (shown
   in the snippet above).
3. (Optional) set `RCAN_DEMO_IFCGUID` to force a specific panel.
4. Launch the orchestrator entry point (`python -m rcan_core.main_rcan`).

On success the demo:

- Requests a panel installation via the smart component API.
- Generates a ROS node script in `src/rcan_nodes/rcan_nodes/generated/`.
- Simulates the robot executing the task (via the generated node) and reports
  the resulting panel state on the in-process broker.

You can rerun the command with a different `RCAN_DEMO_IFCGUID` value to generate
additional nodes; each run overwrites the panel's status in Neo4j through the
state manager service.

The RCAN orchestrator is the single supported execution path. It handles the
Neo4j queries, generates the temporary ROS nodes, launches them, and records the
resulting panel state transitions. If you previously depended on alternate
executors or YAML-driven fallbacks, migrate to the RCAN CLI described below.

### RCAN command line interface

The `rcan` executable (installed from `rcan_core`) merges the legacy
`crane_builder` utilities into the RCAN stack. After sourcing the workspace you
can:

```bash
# Request a single panel by GUID (equivalent to the demo entry point)
rcan install --ifcguid X1

# Sequentially request every ready panel for a host
rcan panel-chain --host WALL_12

# Run the demo helper (also available as `python -m rcan_core.main_rcan`)
rcan demo --ifcguid X1
```

Both `rcan install` and `rcan panel-chain` reuse the in-process broker and
services, so state updates, generated nodes, and ROS handoffs behave exactly as
they do when running the demo module.
